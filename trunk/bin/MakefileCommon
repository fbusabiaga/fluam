# Look for sources in the repository:
vpath %.cu $(SRC_FLUAM)
vpath %.c $(SRC_FLUAM)
vpath %.cpp $(SRC_FLUAM)
vpath %.h $(SRC_FLUAM)


#
#
#If we have HydroGrid add some more sources
ifneq ($(SRC_HYDROLIB),)
      vpath %.c $(SRC_HYDROLIB)
      vpath %.h $(SRC_HYDROLIB)
      vpath %.f90 $(SRC_HYDROLIB)
endif




###NVCCSOURCES += main.cu



OBJS = main.o \
cudaDevice.o \
loadDataMain.o \
initializeRandomNumber.o \
random_frenk.o \
rantest.o \
gauss.o \
schemeThermostat.o \
schemeRK3.o \
schemeBoundary.o \
schemeCompressibleParticles.o \
schemeParticlesWall.o \
schemeIncompressible.o \
schemeIncompressibleBinaryMixture.o \
schemeIncompressibleBinaryMixtureMidPoint.o \
schemeIncompressibleBoundary.o \
schemeQuasiNeutrallyBuoyant.o \
createCells.o \
initializeFluid.o \
initializeFluidParticlesWall.o \
schemeRK3Ghost.o \
createCellsGhost.o \
modu.o \
initializeFluidGhost.o \
GPU.o \
saveTime.o \
saveSeed.o \
saveParticles.o \
temperature.o \
temperatureBoundary.o \
temperatureGhost.o \
temperatureParticlesWall.o \
schemeBinaryMixture.o \
createCellsBinaryMixture.o \
createCellsIncompressibleBinaryMixture.o \
initializeFluidBinaryMixture.o \
totalConcentration.o \
schemeBinaryMixtureWall.o \
initializeFluidBinaryMixtureWall.o \
createBoundaries.o \
createParticles.o \
initializeBondedForces.o \
simpleCubic.o \
freeParticles.o \
schemeGiantFluctuations.o \
initializeFluidGiantFluctuations.o \
schemeContinuousGradient.o \
saveFluidFinalConfiguration.o \
saveFluidVTK.o 

#
#
#If we have HydroGrid add some more functions
ifneq ($(SRC_HYDROLIB),)
      OBJS += \
      hydroAnalysis.o \
      hydroAnalysisGhost.o \
      hydroAnalysisIncompressible.o \
      hydroAnalysisIncompressibleBinaryMixture.o \
      hydroAnalysisParticlesWall.o 
endif

#
#
#Add HydroGrid if you have the code
ifneq ($(SRC_HYDROLIB),)
      OBJS += \
      Precision.o \
      RNG.o \
      Random.o \
      RNGs.o \
      visit_writer.o \
      FFTW.o \
      VisitWriter.o \
      HydroGridModule.o \
      HydroGridCInterface.o 
endif




all : $(OBJS) ; $(NVCC) $(NVCCFLAGS) -o  $(EFILE) $(OBJS) $(LIBS)  \
$(LIBRARIES) -L/usr/lib64/ -L./ -lgfortran -lfftw3 -lfftw3f -lcufft -lm 






main.o : main.cpp header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

cudaDevice.o : cudaDevice.cu header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

saveFluidFinalConfiguration.o : saveFluidFinalConfiguration.cu header.h fluid.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

saveFluidVTK.o : saveFluidVTK.cu header.h fluid.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

loadDataMain.o : loadDataMain.cu header.h cells.h particles.h fluid.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeRandomNumber.o : initializeRandomNumber.cpp header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

random_frenk.o: random_frenk.cu header.h  header_random.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

rantest.o: rantest.cu header.h header_random.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

gauss.o: gauss.cu header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeThermostat.o: schemeThermostat.cu header.h; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeRK3.o: schemeRK3.cu header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeBoundary.o: schemeBoundary.cu header.h cells.h boundary.h particles.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeCompressibleParticles.o: schemeCompressibleParticles.cu header.h cells.h boundary.h particles.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeParticlesWall.o: schemeParticlesWall.cu header.h cells.h boundary.h particles.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeIncompressible.o: schemeIncompressible.cu header.h cells.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeIncompressibleBinaryMixture.o: schemeIncompressibleBinaryMixture.cu header.h cells.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeIncompressibleBinaryMixtureMidPoint.o: schemeIncompressibleBinaryMixtureMidPoint.cu header.h cells.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeIncompressibleBoundary.o: schemeIncompressibleBoundary.cu header.h cells.h boundary.h \
particles.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeQuasiNeutrallyBuoyant.o: schemeQuasiNeutrallyBuoyant.cu header.h cells.h \
boundary.h particles.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

createCells.o: createCells.cpp header.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

createBoundaries.o: createBoundaries.cpp header.h boundary.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

createParticles.o: createParticles.cpp header.h boundary.h particles.h; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeBondedForces.o: initializeBondedForces.cpp header.h boundary.h particles.h; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

simpleCubic.o: simpleCubic.cpp header.h cells.h particles.h; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

freeParticles.o: freeParticles.cu header.h boundary.h particles.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

saveParticles.o: saveParticles.cu header.h particles.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<


initializeFluid.o: initializeFluid.cpp header.h fluid.h cells.h parameters.h temperature.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeFluidparticlesWall.o: initializeFluidParticlesWall.cpp header.h fluid.h \
cells.h parameters.h temperature.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeRK3Ghost.o: schemeRK3Ghost.cu header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

createCellsGhost.o: createCellsGhost.cpp header.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

modu.o: modu.cu ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeFluidGhost.o: initializeFluidGhost.cpp header.h fluid.h cells.h parameters.h temperature.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

saveTime.o: saveTime.cpp header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

saveSeed.o: saveSeed.cpp header.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

temperature.o: temperature.cu header.h fluid.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

temperatureBoundary.o: temperatureBoundary.cu header.h fluid.h cells.h particles.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

temperatureGhost.o: temperatureGhost.cpp header.h fluid.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

temperatureParticlesWall.o: temperatureParticlesWall.cpp header.h fluid.h cells.h particles.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeBinaryMixture.o: schemeBinaryMixture.cu header.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

createCellsBinaryMixture.o: createCellsBinaryMixture.cpp header.h cells.h headerOtherFluidVariables.h; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

createCellsIncompressibleBinaryMixture.o: createCellsIncompressibleBinaryMixture.cu header.h cells.h headerOtherFluidVariables.h; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeFluidBinaryMixture.o: initializeFluidBinaryMixture.cpp header.h fluid.h cells.h \
parameters.h temperature.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

totalConcentration.o: totalConcentration.cpp cells.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeBinaryMixtureWall.o: schemeBinaryMixtureWall.cu header.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeGiantFluctuations.o: schemeGiantFluctuations.cu header.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeFluidBinaryMixtureWall.o: initializeFluidBinaryMixtureWall.cpp header.h fluid.h cells.h \
parameters.h temperature.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

initializeFluidGiantFluctuations.o: initializeFluidGiantFluctuations.cpp header.h fluid.h cells.h \
parameters.h temperature.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<

schemeContinuousGradient.o: schemeContinuousGradient.cu header.h cells.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<


#
#
#If we have HydroGrid
ifneq ($(SRC_HYDROLIB),)
hydroAnalysisGhost.o: hydroAnalysisGhost.cu hydroAnalysis.h cells.h header.h \
fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysisParticlesWall.o: hydroAnalysisParticlesWall.cu hydroAnalysis.h cells.h header.h \
fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysis.o: hydroAnalysis.cu hydroAnalysis.h cells.h header.h fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysisIncompressible.o: hydroAnalysisIncompressible.cu hydroAnalysis.h cells.h \
header.h fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysisIncompressibleBinaryMixture.o: hydroAnalysisIncompressibleBinaryMixture.cu \
hydroAnalysis.h cells.h \
header.h fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

endif







#GPU functions and variables
GPU.o: GPU.cu gpuVariables.cu header.h cells.h fluid.h createCellsGPU.cu createCellsIncompressibleGPU.cu \
createCellsGhostGPU.cu freeMemoryRK3GPU.cu initializeFluidIncompressibleGPU.cu \
freeCellsGhostGPU.cu initializeFluidGhostGPU.cu initializeFluidGPU.cu runSchemeRK3.cu runSchemeThermostat.cu \
runSchemeRK3Ghost.cu texturesCells.cu runSchemeBoundary.cu runSchemeIncompressible.cu \
kernelConstructW.cu realToComplex.cu \
runSchemeIncompressibleBoundary.cu initializePrefactorFourierSpace.cu \
initGhostIndexGPU.cu kernelDpRK3.cu kernelDpThermostat.cu kernelDpRK3Ghost.cu moduGPU.cu \
saveFunctionsSchemeRK3.cu \
saveFunctionsSchemeThermostat.cu saveFunctionsSchemeBoundary.cu \
saveFunctionsSchemeRK3Ghost.cu gpuToHostRK3.cu kernelFeedGhostCellsRK3.cu \
runSchemeBinaryMixture.cu kernelDpBinaryMixture.cu kernelFeedGhostCellsBinaryMixture.cu \
gpuToHostBinaryMixture.cu saveFunctionsSchemeBinaryMixture.cu initializeFluidBinaryMixtureGPU.cu \
freeCellsBinaryMixtureGPU.cu createCellsBinaryMixtureGPU.cu runSchemeBinaryMixtureWall.cu \
kernelFeedGhostCellsBinaryMixtureWall.cu copyToGPUBinaryMixtureWall.cu runSchemeGiantFluctuations.cu \
kernelDpGiantFluctuations.cu kernelFeedGhostCellsGiantFluctuations.cu copyToGPUGiantFluctuations.cu \
runSchemeContinuousGradient.cu kernelDpContinuousGradient.cu randomNumbers.cu createBoundariesGPU.cu \
freeBoundariesGPU.cu allocateErrorArray.cu deltaGPU.cu initParticlesInCell.cu \
boundaryParticlesFunction.cu initializeNeighborsGPU.cu findNeighborParticles.cu forceBoundaryGPU.cu \
nonBondedForce.cu nonBondedForceExtraPressure.cu updateFluid.cu gpuToHostParticles.cu initForcesNonBonded.cu \
kernelUpdateVIncompressible.cu gpuToHostIncompressible.cu saveFunctionsSchemeIncompressible.cu \
gpuToHostIncompressibleBoundary.cu boundaryParticlesFunctionIncompressible.cu nonBondedForceIncompressible.cu \
saveFunctionsSchemeIncompressibleBoundary.cu projectionDivergenceFree.cu checkVelocity.cu \
forceIncompressibleBoundaryGPU.cu createBoundariesRK2GPU.cu freeBoundariesRK2GPU.cu \
gpuToHostIncompressibleBoundaryRK2.cu runSchemeQuasiNeutrallyBuoyant.cu kernelSpreadParticles.cu \
kernelConstructWQuasiNeutrallyBuoyant.cu \
kernelCorrectionVQuasiNeutrallyBuoyant.cu quasiNeutrallyBuoyantFunctions.cu firstStepQuasiNeutrallyBuoyant.cu \
calculateAdvectionFluid.cu interpolateField.cu runSchemeCompressibleParticles.cu \
boundaryParticlesFunctionCompressibleParticles.cu nonBondedForceCompressibleParticles.cu \
nonBondedForceCompressibleParticlesExtraPressure.cu \
calculateVelocityAtHalfTimeStepCompressibleParticles.cu kernelDpCompressibleParticles.cu \
createCellsIncompressibleBinaryMixtureGPU.cu freeCellsIncompressibleBinaryMixtureGPU.cu \
runSchemeIncompressibleBinaryMixture.cu runSchemeIncompressibleBinaryMixtureMidPoint.cu kernelConstructWBinaryMixture.cu \
kernelUpdateIncompressibleBinaryMixture.cu \
saveFunctionsSchemeIncompressibleBinaryMixture.cu saveFunctionsSchemeParticlesWall.cu \
runSchemeParticlesWall.cu initGhostIndexParticlesWallGPU.cu kernelFeedGhostCellsParticlesWall.cu \
initializeVecinosGPU.cu kernelDpParticlesWall.cu boundaryParticlesFunctionParticlesWall.cu \
saveFunctionsSchemeIncompressibleBinaryMixture.cu createBondedForcesGPU.cu \
freeBondedForcesGPU.cu forceBondedGPU.cu ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  -c $<






#
#
#If we have HydroGrid
ifneq ($(SRC_HYDROLIB)),)
#HydroAnalisis from Aleks
Precision.o: Precision.f90 ; \
	$(FC) $(FCFLAGS) -c $<

RNG.o: RNG.f90 Random.o ; \
	$(FC) $(FCFLAGS) -c $<

Random.o: Random.f90 Precision.o ; \
	$(FC) $(FCFLAGS) -c $<

RNGs.o: RNGs.c ; \
	$(NVCC) $(NVCCFLAGS) -c -DBL_FORT_USE_UNDERSCORE $<

visit_writer.o: visit_writer.c ; \
	$(NVCC) $(NVCCFLAGS) -c $<

FFTW.o: FFTW.f90 Precision.o ; \
	$(FC) $(FCFLAGS) -c $<

VisitWriter.o: VisitWriter.f90 ; \
	$(FC) $(FCFLAGS) -c $<

HydroGridModule.o: HydroGridModule.f90 FFTW.o VisitWriter.o ; \
	$(FC) $(FCFLAGS) -c $<

HydroGridCInterface.o: HydroGridCInterface.f90 HydroGridModule.o ; \
	$(FC) $(FCFLAGS) -c $<
endif

clean:	; rm -f $(OBJS) $(EFILE) *.mod *.o





