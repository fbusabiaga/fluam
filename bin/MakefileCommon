# Look for sources in the repository:
vpath %.cu $(SRC_FLUAM)
vpath %.c $(SRC_FLUAM)
vpath %.cpp $(SRC_FLUAM)
vpath %.h $(SRC_FLUAM)


#
#
#If we have HydroGrid add some more sources
ifneq ($(SRC_HYDROLIB),)
      vpath %.c $(SRC_HYDROLIB)
      vpath %.h $(SRC_HYDROLIB)
      vpath %.f90 $(SRC_HYDROLIB)
endif




OBJS = main.o 

#
#
#If we have HydroGrid add some more functions
ifneq ($(SRC_HYDROLIB),)
      OBJS += \
      hydroAnalysis.o \
      hydroAnalysisGhost.o \
      hydroAnalysisIncompressible.o \
      hydroAnalysisIncompressibleBinaryMixture.o \
      hydroAnalysisParticlesWall.o 
endif

#
#
#Add HydroGrid if you have the code
ifneq ($(SRC_HYDROLIB),)
      OBJS += \
      Precision.o \
      RNG.o \
      Random.o \
      RNGs.o \
      visit_writer.o \
      FFTW.o \
      VisitWriter.o \
      HydroGridModule.o \
      HydroGridCInterface.o 
endif





all : $(OBJS) ; $(NVCC) $(NVCCFLAGSLINK) -o  $(EFILE) $(OBJS) $(STATIC_LIBRARIES) $(LIBRARIES) 



# main.o : main.cpp header.h ; \
# $(NVCC) $(NVCCFLAGS) $(NVCCINCLS) $(HDRS) -c $<

%.o: %.cpp 
	$(NVCC) $(NVCCFLAGS) $< -o $@
%.o: %.f90
	$(FC) $(FCFLAGS) -O3 -c $< -o $@






#
#
#If we have HydroGrid
ifneq ($(SRC_HYDROLIB),)
hydroAnalysisGhost.o: hydroAnalysisGhost.cu hydroAnalysis.h cells.h header.h \
fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysisParticlesWall.o: hydroAnalysisParticlesWall.cu hydroAnalysis.h cells.h header.h \
fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysis.o: hydroAnalysis.cu hydroAnalysis.h cells.h header.h fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysisIncompressible.o: hydroAnalysisIncompressible.cu hydroAnalysis.h cells.h \
header.h fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

hydroAnalysisIncompressibleBinaryMixture.o: hydroAnalysisIncompressibleBinaryMixture.cu \
hydroAnalysis.h cells.h \
header.h fluid.h headerOtherFluidVariables.h ; \
$(NVCC) $(NVCCFLAGS) $(NVCCINCLS)  $(HydroAnalisysINCL) -c $<

endif









#
#
#If we have HydroGrid
ifneq ($(SRC_HYDROLIB)),)
#HydroAnalisis from Aleks
Precision.o: Precision.f90 ; \
	$(FC) $(FCFLAGS) -c $<

RNG.o: RNG.f90 Random.o ; \
	$(FC) $(FCFLAGS) -c $<

Random.o: Random.f90 Precision.o ; \
	$(FC) $(FCFLAGS) -c $<

RNGs.o: RNGs.c ; \
	$(NVCC) $(NVCCFLAGS) -c -DBL_FORT_USE_UNDERSCORE $<

visit_writer.o: visit_writer.c ; \
	$(NVCC) $(NVCCFLAGS) -c $<

FFTW.o: FFTW.f90 Precision.o ; \
	$(FC) $(FCFLAGS) -c $<

VisitWriter.o: VisitWriter.f90 ; \
	$(FC) $(FCFLAGS) -c $<

HydroGridModule.o: HydroGridModule.f90 FFTW.o VisitWriter.o ; \
	$(FC) $(FCFLAGS) -c $<

HydroGridCInterface.o: HydroGridCInterface.f90 HydroGridModule.o ; \
	$(FC) $(FCFLAGS) -c $<
endif

clean:	; rm -f $(OBJS) $(EFILE) *.mod *.o





